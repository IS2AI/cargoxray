schema: '2.0'
stages:
  select_and_export:
    cmd: python src/data/export_data.py
    deps:
    - path: data
      md5: ccf701575ceca81313792e4e722a6418.dir
      size: 101642784629
      nfiles: 17782
    - path: src/data/Cargoxray.py
      md5: 153833faa1e5a3546e372c0afec7af5f
      size: 18212
    - path: src/data/config.py
      md5: 6c915b47555939aa1a1c920d7acb5f07
      size: 797
    - path: src/data/export_data.py
      md5: 55d9bcae15f30e0e1fe88894804b6184
      size: 1258
    - path: src/data/label_mappings_fix.csv
      md5: 905e2b9690f176b443a12d2edbbfa3f7
      size: 3239
    - path: src/data/utils.py
      md5: e3b25979b2312997ddf238bb30cb73dd
      size: 3525
    outs:
    - path: prepared_data
      md5: 89626728a1e0813e12e9516157e7cd5a.dir
      size: 61227474965
      nfiles: 22899
  train:
    cmd: python src/model/yolov5/train.py --weights models/pretrained/weights/best.pt
      --data prepared_data/dataset.yaml --hyp models/params/hyp.yaml --epochs 100
      --batch-size 64 --imgsz 1024 --device 0 --project models --name results --cache
    deps:
    - path: models/pretrained/weights/best.pt
      md5: 175bdbbeb8c2d0a2ebbbc3489e8fb15d
      size: 25378645
    - path: prepared_data
      md5: 1da8521184bc56f7740e7a87ce81e3b3.dir
      size: 61229705012
      nfiles: 22901
    - path: src/model
      md5: 2f6aed3f91016a011be17c8d953dff83.dir
      size: 1521781
      nfiles: 129
    params:
      models/params/hyp.yaml:
        anchor_t: 4.0
        box: 0.05
        cls: 0.3
        cls_pw: 1.0
        copy_paste: 0.0
        degrees: 3.0
        fl_gamma: 0.0
        fliplr: 0.5
        flipud: 0.0
        hsv_h: 0.0
        hsv_s: 0.0
        hsv_v: 0.25
        iou_t: 0.2
        lr0: 0.01
        lrf: 0.2
        mixup: 0.2
        momentum: 0.937
        mosaic: 1.0
        obj: 0.7
        obj_pw: 1.0
        perspective: 0.0
        scale: 0.5
        shear: 3.0
        translate: 0.1
        warmup_bias_lr: 0.1
        warmup_epochs: 3.0
        warmup_momentum: 0.8
        weight_decay: 0.0005
    outs:
    - path: models/results
      md5: 9dafa3e15b06b3ed23451734cd0703b3.dir
      size: 57305233
      nfiles: 23
  prepare_opix:
    cmd: python src/data/prepare_opix.py
    deps:
    - path: opix_dataset/
      md5: c26669dd13a739ed3c45b2731a1ac488.dir
      size: 2634287221
      nfiles: 17771
    - path: src/data/prepare_opix.py
      md5: 945c4f2d08b9eb0135eab1b6e60db1cc
      size: 648
    outs:
    - path: prepared_opix
      md5: 6669c3a6edd7f6debfaee8f1e9eef764.dir
      size: 1056779606
      nfiles: 17771
  pretrain:
    cmd: sh src/model/pretrain.sh
    deps:
    - path: prepared_opix
      md5: 9169698510bf104be479cd4e45e956fd.dir
      size: 1058686437
      nfiles: 17773
    - path: src/model
      md5: 61d574a5974f5f526869f45e43810b09.dir
      size: 16359800
      nfiles: 135
    params:
      models/params/pretrain_hyp.yaml:
        anchor_t: 4.0
        box: 0.05
        cls: 0.3
        cls_pw: 1.0
        copy_paste: 0.0
        degrees: 3.0
        fl_gamma: 0.0
        fliplr: 0.5
        flipud: 0.0
        hsv_h: 0.0
        hsv_s: 0.0
        hsv_v: 0.25
        iou_t: 0.2
        lr0: 0.01
        lrf: 0.2
        mixup: 0.2
        momentum: 0.937
        mosaic: 1.0
        obj: 0.7
        obj_pw: 1.0
        perspective: 0.0
        scale: 0.5
        shear: 3.0
        translate: 0.1
        warmup_bias_lr: 0.1
        warmup_epochs: 3.0
        warmup_momentum: 0.8
        weight_decay: 0.0005
    outs:
    - path: models/pretrained
      md5: c2cdd612ea040f2b4972d1e5d957d743.dir
      size: 56184479
      nfiles: 24
  prepare_data:
    cmd: python src/data/export_data.py
    deps:
    - path: data
      md5: 6628748c0830810a15cc78c756ccf09c.dir
      size: 101642814780
      nfiles: 17782
    - path: src/data/common
      md5: 32e1c968a2a01d1b9e0e31b8e7c84855.dir
      size: 63042
      nfiles: 10
    - path: src/data/export_data.py
      md5: 7d858ddf1efb6a435563a81bf0292631
      size: 1162
    outs:
    - path: prepared_data
      md5: 2603f56451c38feda624fa21da90ea7c.dir
      size: 61227474983
      nfiles: 22899
  direct_train:
    cmd: python src/model/yolov5/train.py --weights /usr/src/basemodels/yolov5s6.pt
      --data prepared_data/dataset.yaml --hyp models/params/hyp.yaml --epochs 100
      --batch-size 64 --imgsz 1024 --device 0 --project models --name direct_results
      --cache
    deps:
    - path: prepared_data
      md5: 1da8521184bc56f7740e7a87ce81e3b3.dir
      size: 61229705012
      nfiles: 22901
    - path: src/model
      md5: 2f6aed3f91016a011be17c8d953dff83.dir
      size: 1521781
      nfiles: 129
    params:
      models/params/hyp.yaml:
        anchor_t: 4.0
        box: 0.05
        cls: 0.3
        cls_pw: 1.0
        copy_paste: 0.0
        degrees: 3.0
        fl_gamma: 0.0
        fliplr: 0.5
        flipud: 0.0
        hsv_h: 0.0
        hsv_s: 0.0
        hsv_v: 0.25
        iou_t: 0.2
        lr0: 0.01
        lrf: 0.2
        mixup: 0.2
        momentum: 0.937
        mosaic: 1.0
        obj: 0.7
        obj_pw: 1.0
        perspective: 0.0
        scale: 0.5
        shear: 3.0
        translate: 0.1
        warmup_bias_lr: 0.1
        warmup_epochs: 3.0
        warmup_momentum: 0.8
        weight_decay: 0.0005
    outs:
    - path: models/direct_results
      md5: 3bd5d3d18a4f2897a68395572ff5e43b.dir
      size: 57230116
      nfiles: 23
  fine_tune:
    cmd: sh src/model/train.sh
    deps:
    - path: models/pretrained/weights/best.pt
      md5: 80263855dc70b94873722e5ac27365b4
      size: 25378645
    - path: prepared_data
      md5: 1da8521184bc56f7740e7a87ce81e3b3.dir
      size: 61229705012
      nfiles: 22901
    - path: src/model
      md5: 61d574a5974f5f526869f45e43810b09.dir
      size: 16359800
      nfiles: 135
    params:
      models/params/hyp.yaml:
        anchor_t: 4.0
        box: 0.05
        cls: 0.3
        cls_pw: 1.0
        copy_paste: 0.0
        degrees: 3.0
        fl_gamma: 0.0
        fliplr: 0.5
        flipud: 0.0
        hsv_h: 0.0
        hsv_s: 0.0
        hsv_v: 0.25
        iou_t: 0.2
        lr0: 0.01
        lrf: 0.2
        mixup: 0.2
        momentum: 0.937
        mosaic: 1.0
        obj: 0.7
        obj_pw: 1.0
        perspective: 0.0
        scale: 0.5
        shear: 3.0
        translate: 0.1
        warmup_bias_lr: 0.1
        warmup_epochs: 3.0
        warmup_momentum: 0.8
        weight_decay: 0.0005
    outs:
    - path: models/results
      md5: 4109d6db026e20f2bc557b141dc19d00.dir
      size: 56373332
      nfiles: 24
  evaluate:
    cmd: sh src/model/evaluate.sh
    deps:
    - path: models/results/weights/best.pt
      md5: 5740e1408c565a7be38aa67e53487570
      size: 25525333
    - path: prepared_data/test
      md5: e0166df1a6951af94861932760d7170c.dir
      size: 6280312525
      nfiles: 2271
    - path: src/model
      md5: 61d574a5974f5f526869f45e43810b09.dir
      size: 16359800
      nfiles: 135
    outs:
    - path: models/metrics/results.json
      md5: 747ef01d372242312f1ca94d7d816940
      size: 1394
